import{S as ln,i as sn,s as an,k as dn,l as un,m as fn,h as we,n as pn,b as gn,I as ee,o as hn,w as mn}from"./index.dbf4ef36.js";const vn=["white","black"],le=["a","b","c","d","e","f","g","h"],se=["1","2","3","4","5","6","7","8"],bn=[...se].reverse(),ae=Array.prototype.concat(...le.map(e=>se.map(n=>e+n))),C=e=>ae[8*e[0]+e[1]],m=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],qe=ae.map(m);function wn(e){let n;const o=()=>(n===void 0&&(n=e()),n);return o.clear=()=>{n=void 0},o}const yn=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const n=performance.now()-e;return e=void 0,n}}},de=e=>e==="white"?"black":"white",X=(e,n)=>{const o=e[0]-n[0],r=e[1]-n[1];return o*o+r*r},te=(e,n)=>e.role===n.role&&e.color===n.color,Y=e=>(n,o)=>[(o?n[0]:7-n[0])*e.width/8,(o?7-n[1]:n[1])*e.height/8],A=(e,n)=>{e.style.transform=`translate(${n[0]}px,${n[1]}px)`},Oe=(e,n,o=1)=>{e.style.transform=`translate(${n[0]}px,${n[1]}px) scale(${o})`},ue=(e,n)=>{e.style.visibility=n?"visible":"hidden"},B=e=>{var n;if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if(!((n=e.targetTouches)===null||n===void 0)&&n[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},_e=e=>e.buttons===2||e.button===2,D=(e,n)=>{const o=document.createElement(e);return n&&(o.className=n),o};function Ke(e,n,o){const r=m(e);return n||(r[0]=7-r[0],r[1]=7-r[1]),[o.left+o.width*r[0]/8+o.width/16,o.top+o.height*(7-r[1])/8+o.height/16]}const W=(e,n)=>Math.abs(e-n),Pn=e=>(n,o,r,t)=>W(n,r)<2&&(e==="white"?t===o+1||o<=1&&t===o+2&&n===r:t===o-1||o>=6&&t===o-2&&n===r),Ne=(e,n,o,r)=>{const t=W(e,o),i=W(n,r);return t===1&&i===2||t===2&&i===1},Te=(e,n,o,r)=>W(e,o)===W(n,r),Ee=(e,n,o,r)=>e===o||n===r,He=(e,n,o,r)=>Te(e,n,o,r)||Ee(e,n,o,r),kn=(e,n,o)=>(r,t,i,l)=>W(r,i)<2&&W(t,l)<2||o&&t===l&&t===(e==="white"?0:7)&&(r===4&&(i===2&&n.includes(0)||i===6&&n.includes(7))||n.includes(i));function Sn(e,n){const o=n==="white"?"1":"8",r=[];for(const[t,i]of e)t[1]===o&&i.color===n&&i.role==="rook"&&r.push(m(t)[0]);return r}function Le(e,n,o){const r=e.get(n);if(!r)return[];const t=m(n),i=r.role,l=i==="pawn"?Pn(r.color):i==="knight"?Ne:i==="bishop"?Te:i==="rook"?Ee:i==="queen"?He:kn(r.color,Sn(e,r.color),o);return qe.filter(c=>(t[0]!==c[0]||t[1]!==c[1])&&l(t[0],t[1],c[0],c[1])).map(C)}function b(e,...n){e&&setTimeout(()=>e(...n),1)}function Cn(e){e.orientation=de(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function Mn(e,n){for(const[o,r]of n)r?e.pieces.set(o,r):e.pieces.delete(o)}function xn(e,n){if(e.check=void 0,n===!0&&(n=e.turnColor),n)for(const[o,r]of e.pieces)r.role==="king"&&r.color===n&&(e.check=o)}function An(e,n,o,r){T(e),e.premovable.current=[n,o],b(e.premovable.events.set,n,o,r)}function N(e){e.premovable.current&&(e.premovable.current=void 0,b(e.premovable.events.unset))}function $n(e,n,o){N(e),e.predroppable.current={role:n,key:o},b(e.predroppable.events.set,n,o)}function T(e){const n=e.predroppable;n.current&&(n.current=void 0,b(n.events.unset))}function Dn(e,n,o){if(!e.autoCastle)return!1;const r=e.pieces.get(n);if(!r||r.role!=="king")return!1;const t=m(n),i=m(o);if(t[1]!==0&&t[1]!==7||t[1]!==i[1])return!1;t[0]===4&&!e.pieces.has(o)&&(i[0]===6?o=C([7,i[1]]):i[0]===2&&(o=C([0,i[1]])));const l=e.pieces.get(o);return!l||l.color!==r.color||l.role!=="rook"?!1:(e.pieces.delete(n),e.pieces.delete(o),t[0]<i[0]?(e.pieces.set(C([6,i[1]]),r),e.pieces.set(C([5,i[1]]),l)):(e.pieces.set(C([2,i[1]]),r),e.pieces.set(C([3,i[1]]),l)),!0)}function Re(e,n,o){const r=e.pieces.get(n),t=e.pieces.get(o);if(n===o||!r)return!1;const i=t&&t.color!==r.color?t:void 0;return o===e.selected&&M(e),b(e.events.move,n,o,i),Dn(e,n,o)||(e.pieces.set(o,r),e.pieces.delete(n)),e.lastMove=[n,o],e.check=void 0,b(e.events.change),i||!0}function fe(e,n,o,r){if(e.pieces.has(o))if(r)e.pieces.delete(o);else return!1;return b(e.events.dropNewPiece,n,o),e.pieces.set(o,n),e.lastMove=[o],e.check=void 0,b(e.events.change),e.movable.dests=void 0,e.turnColor=de(e.turnColor),!0}function We(e,n,o){const r=Re(e,n,o);return r&&(e.movable.dests=void 0,e.turnColor=de(e.turnColor),e.animation.current=void 0),r}function Be(e,n,o){if(pe(e,n,o)){const r=We(e,n,o);if(r){const t=e.hold.stop();M(e);const i={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:t};return r!==!0&&(i.captured=r),b(e.movable.events.after,n,o,i),!0}}else if(On(e,n,o))return An(e,n,o,{ctrlKey:e.stats.ctrlKey}),M(e),!0;return M(e),!1}function ze(e,n,o,r){const t=e.pieces.get(n);t&&(qn(e,n,o)||r)?(e.pieces.delete(n),fe(e,t,o,r),b(e.movable.events.afterNewPiece,t.role,o,{premove:!1,predrop:!1})):t&&_n(e,n,o)?$n(e,t.role,o):(N(e),T(e)),e.pieces.delete(n),M(e)}function ie(e,n,o){if(b(e.events.select,n),e.selected){if(e.selected===n&&!e.draggable.enabled){M(e),e.hold.cancel();return}else if((e.selectable.enabled||o)&&e.selected!==n&&Be(e,e.selected,n)){e.stats.dragged=!1;return}}(e.selectable.enabled||e.draggable.enabled)&&(Ie(e,n)||ge(e,n))&&(Fe(e,n),e.hold.start())}function Fe(e,n){e.selected=n,ge(e,n)?e.premovable.dests=Le(e.pieces,n,e.premovable.castle):e.premovable.dests=void 0}function M(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function Ie(e,n){const o=e.pieces.get(n);return!!o&&(e.movable.color==="both"||e.movable.color===o.color&&e.turnColor===o.color)}const pe=(e,n,o)=>{var r,t;return n!==o&&Ie(e,n)&&(e.movable.free||!!(!((t=(r=e.movable.dests)===null||r===void 0?void 0:r.get(n))===null||t===void 0)&&t.includes(o)))};function qn(e,n,o){const r=e.pieces.get(n);return!!r&&(n===o||!e.pieces.has(o))&&(e.movable.color==="both"||e.movable.color===r.color&&e.turnColor===r.color)}function ge(e,n){const o=e.pieces.get(n);return!!o&&e.premovable.enabled&&e.movable.color===o.color&&e.turnColor!==o.color}const On=(e,n,o)=>n!==o&&ge(e,n)&&Le(e.pieces,n,e.premovable.castle).includes(o);function _n(e,n,o){const r=e.pieces.get(n),t=e.pieces.get(o);return!!r&&(!t||t.color!==e.movable.color)&&e.predroppable.enabled&&(r.role!=="pawn"||o[1]!=="1"&&o[1]!=="8")&&e.movable.color===r.color&&e.turnColor!==r.color}function Kn(e,n){const o=e.pieces.get(n);return!!o&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===o.color&&(e.turnColor===o.color||e.premovable.enabled))}function Nn(e){const n=e.premovable.current;if(!n)return!1;const o=n[0],r=n[1];let t=!1;if(pe(e,o,r)){const i=We(e,o,r);if(i){const l={premove:!0};i!==!0&&(l.captured=i),b(e.movable.events.after,o,r,l),t=!0}}return N(e),t}function Tn(e,n){const o=e.predroppable.current;let r=!1;if(!o)return!1;if(n(o)){const t={role:o.role,color:e.movable.color};fe(e,t,o.key)&&(b(e.movable.events.afterNewPiece,o.role,o.key,{premove:!1,predrop:!0}),r=!0)}return T(e),r}function he(e){N(e),T(e),M(e)}function ye(e){e.movable.color=e.movable.dests=e.animation.current=void 0,he(e)}function z(e,n,o){let r=Math.floor(8*(e[0]-o.left)/o.width);n||(r=7-r);let t=7-Math.floor(8*(e[1]-o.top)/o.height);return n||(t=7-t),r>=0&&r<8&&t>=0&&t<8?C([r,t]):void 0}function En(e,n,o,r){const t=m(e),i=qe.filter(s=>He(t[0],t[1],s[0],s[1])||Ne(t[0],t[1],s[0],s[1])),c=i.map(s=>Ke(C(s),o,r)).map(s=>X(n,s)),[,a]=c.reduce((s,g,d)=>s[0]<g?s:[g,d],[c[0],0]);return C(i[a])}const w=e=>e.orientation==="white",me="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Hn={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},Ln={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function je(e){e==="start"&&(e=me);const n=new Map;let o=7,r=0;for(const t of e)switch(t){case" ":case"[":return n;case"/":if(--o,o<0)return n;r=0;break;case"~":{const i=n.get(C([r-1,o]));i&&(i.promoted=!0);break}default:{const i=t.charCodeAt(0);if(i<57)r+=i-48;else{const l=t.toLowerCase();n.set(C([r,o]),{role:Hn[l],color:t===l?"black":"white"}),++r}}}return n}function Rn(e){return bn.map(n=>le.map(o=>{const r=e.get(o+n);if(r){let t=Ln[r.role];return r.color==="white"&&(t=t.toUpperCase()),r.promoted&&(t+="~"),t}else return"1"}).join("")).join("/").replace(/1{2,}/g,n=>n.length.toString())}function Ve(e,n){n.animation&&(ve(e.animation,n.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function Ze(e,n){var o,r,t;if(!((o=n.movable)===null||o===void 0)&&o.dests&&(e.movable.dests=void 0),!((r=n.drawable)===null||r===void 0)&&r.autoShapes&&(e.drawable.autoShapes=[]),ve(e,n),n.fen&&(e.pieces=je(n.fen),e.drawable.shapes=((t=n.drawable)===null||t===void 0?void 0:t.shapes)||[]),"check"in n&&xn(e,n.check||!1),"lastMove"in n&&!n.lastMove?e.lastMove=void 0:n.lastMove&&(e.lastMove=n.lastMove),e.selected&&Fe(e,e.selected),Ve(e,n),!e.movable.rookCastle&&e.movable.dests){const i=e.movable.color==="white"?"1":"8",l="e"+i,c=e.movable.dests.get(l),a=e.pieces.get(l);if(!c||!a||a.role!=="king")return;e.movable.dests.set(l,c.filter(s=>!(s==="a"+i&&c.includes("c"+i))&&!(s==="h"+i&&c.includes("g"+i))))}}function ve(e,n){for(const o in n)Object.prototype.hasOwnProperty.call(n,o)&&(Object.prototype.hasOwnProperty.call(e,o)&&Pe(e[o])&&Pe(n[o])?ve(e[o],n[o]):e[o]=n[o])}function Pe(e){if(typeof e!="object"||e===null)return!1;const n=Object.getPrototypeOf(e);return n===Object.prototype||n===null}const R=(e,n)=>n.animation.enabled?zn(e,n):_(e,n);function _(e,n){const o=e(n);return n.dom.redraw(),o}const ne=(e,n)=>({key:e,pos:m(e),piece:n}),Wn=(e,n)=>n.sort((o,r)=>X(e.pos,o.pos)-X(e.pos,r.pos))[0];function Bn(e,n){const o=new Map,r=[],t=new Map,i=[],l=[],c=new Map;let a,s,g;for(const[d,v]of e)c.set(d,ne(d,v));for(const d of ae)a=n.pieces.get(d),s=c.get(d),a?s?te(a,s.piece)||(i.push(s),l.push(ne(d,a))):l.push(ne(d,a)):s&&i.push(s);for(const d of l)s=Wn(d,i.filter(v=>te(d.piece,v.piece))),s&&(g=[s.pos[0]-d.pos[0],s.pos[1]-d.pos[1]],o.set(d.key,g.concat(g)),r.push(s.key));for(const d of i)r.includes(d.key)||t.set(d.key,d.piece);return{anims:o,fadings:t}}function Ge(e,n){const o=e.animation.current;if(o===void 0){e.dom.destroyed||e.dom.redrawNow();return}const r=1-(n-o.start)*o.frequency;if(r<=0)e.animation.current=void 0,e.dom.redrawNow();else{const t=Fn(r);for(const i of o.plan.anims.values())i[2]=i[0]*t,i[3]=i[1]*t;e.dom.redrawNow(!0),requestAnimationFrame((i=performance.now())=>Ge(e,i))}}function zn(e,n){const o=new Map(n.pieces),r=e(n),t=Bn(o,n);if(t.anims.size||t.fadings.size){const i=n.animation.current&&n.animation.current.start;n.animation.current={start:performance.now(),frequency:1/n.animation.duration,plan:t},i||Ge(n,performance.now())}else n.dom.redraw();return r}const Fn=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,In=["green","red","blue","yellow"];function jn(e,n){if(n.touches&&n.touches.length>1)return;n.stopPropagation(),n.preventDefault(),n.ctrlKey?M(e):he(e);const o=B(n),r=z(o,w(e),e.dom.bounds());r&&(e.drawable.current={orig:r,pos:o,brush:Un(n),snapToValidMove:e.drawable.defaultSnapToValidMove},Ue(e))}function Ue(e){requestAnimationFrame(()=>{const n=e.drawable.current;if(n){const o=z(n.pos,w(e),e.dom.bounds());o||(n.snapToValidMove=!1);const r=n.snapToValidMove?En(n.orig,n.pos,w(e),e.dom.bounds()):o;r!==n.mouseSq&&(n.mouseSq=r,n.dest=r!==n.orig?r:void 0,e.dom.redrawNow()),Ue(e)}})}function Vn(e,n){e.drawable.current&&(e.drawable.current.pos=B(n))}function Zn(e){const n=e.drawable.current;n&&(n.mouseSq&&Xn(e.drawable,n),Xe(e))}function Xe(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function Gn(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),Ye(e.drawable))}function Un(e){var n;const o=(e.shiftKey||e.ctrlKey)&&_e(e),r=e.altKey||e.metaKey||((n=e.getModifierState)===null||n===void 0?void 0:n.call(e,"AltGraph"));return In[(o?1:0)+(r?2:0)]}function Xn(e,n){const o=t=>t.orig===n.orig&&t.dest===n.dest,r=e.shapes.find(o);r&&(e.shapes=e.shapes.filter(t=>!o(t))),(!r||r.brush!==n.brush)&&e.shapes.push({orig:n.orig,dest:n.dest,brush:n.brush}),Ye(e)}function Ye(e){e.onChange&&e.onChange(e.shapes)}function Yn(e,n){if(!n.isTrusted||n.button!==void 0&&n.button!==0||n.touches&&n.touches.length>1)return;const o=e.dom.bounds(),r=B(n),t=z(r,w(e),o);if(!t)return;const i=e.pieces.get(t),l=e.selected;!l&&e.drawable.enabled&&(e.drawable.eraseOnClick||!i||i.color!==e.turnColor)&&Gn(e),n.cancelable!==!1&&(!n.touches||e.blockTouchScroll||i||l||Qn(e,r))&&n.preventDefault();const c=!!e.premovable.current,a=!!e.predroppable.current;e.stats.ctrlKey=n.ctrlKey,e.selected&&pe(e,e.selected,t)?R(d=>ie(d,t),e):ie(e,t);const s=e.selected===t,g=Je(e,t);if(i&&g&&s&&Kn(e,t)){e.draggable.current={orig:t,piece:i,origPos:r,pos:r,started:e.draggable.autoDistance&&e.stats.dragged,element:g,previouslySelected:l,originTarget:n.target,keyHasChanged:!1},g.cgDragging=!0,g.classList.add("dragging");const d=e.dom.elements.ghost;d&&(d.className=`ghost ${i.color} ${i.role}`,A(d,Y(o)(m(t),w(e))),ue(d,!0)),be(e)}else c&&N(e),a&&T(e);e.dom.redraw()}function Qn(e,n){const o=w(e),r=e.dom.bounds(),t=Math.pow(r.width/8,2);for(const i of e.pieces.keys()){const l=Ke(i,o,r);if(X(l,n)<=t)return!0}return!1}function Jn(e,n,o,r){const t="a0";e.pieces.set(t,n),e.dom.redraw();const i=B(o);e.draggable.current={orig:t,piece:n,origPos:i,pos:i,started:!0,element:()=>Je(e,t),originTarget:o.target,newPiece:!0,force:!!r,keyHasChanged:!1},be(e)}function be(e){requestAnimationFrame(()=>{var n;const o=e.draggable.current;if(!o)return;!((n=e.animation.current)===null||n===void 0)&&n.plan.anims.has(o.orig)&&(e.animation.current=void 0);const r=e.pieces.get(o.orig);if(!r||!te(r,o.piece))Q(e);else if(!o.started&&X(o.pos,o.origPos)>=Math.pow(e.draggable.distance,2)&&(o.started=!0),o.started){if(typeof o.element=="function"){const i=o.element();if(!i)return;i.cgDragging=!0,i.classList.add("dragging"),o.element=i}const t=e.dom.bounds();A(o.element,[o.pos[0]-t.left-t.width/16,o.pos[1]-t.top-t.height/16]),o.keyHasChanged||(o.keyHasChanged=o.orig!==z(o.pos,w(e),t))}be(e)})}function eo(e,n){e.draggable.current&&(!n.touches||n.touches.length<2)&&(e.draggable.current.pos=B(n))}function no(e,n){const o=e.draggable.current;if(!o)return;if(n.type==="touchend"&&n.cancelable!==!1&&n.preventDefault(),n.type==="touchend"&&o.originTarget!==n.target&&!o.newPiece){e.draggable.current=void 0;return}N(e),T(e);const r=B(n)||o.pos,t=z(r,w(e),e.dom.bounds());t&&o.started&&o.orig!==t?o.newPiece?ze(e,o.orig,t,o.force):(e.stats.ctrlKey=n.ctrlKey,Be(e,o.orig,t)&&(e.stats.dragged=!0)):o.newPiece?e.pieces.delete(o.orig):e.draggable.deleteOnDropOff&&!t&&(e.pieces.delete(o.orig),b(e.events.change)),(o.orig===o.previouslySelected||o.keyHasChanged)&&(o.orig===t||!t)?M(e):e.selectable.enabled||M(e),Qe(e),e.draggable.current=void 0,e.dom.redraw()}function Q(e){const n=e.draggable.current;n&&(n.newPiece&&e.pieces.delete(n.orig),e.draggable.current=void 0,M(e),Qe(e),e.dom.redraw())}function Qe(e){const n=e.dom.elements;n.ghost&&ue(n.ghost,!1)}function Je(e,n){let o=e.dom.elements.board.firstChild;for(;o;){if(o.cgKey===n&&o.tagName==="PIECE")return o;o=o.nextSibling}}function oo(e,n){e.exploding={stage:1,keys:n},e.dom.redraw(),setTimeout(()=>{ke(e,2),setTimeout(()=>ke(e,void 0),120)},120)}function ke(e,n){e.exploding&&(n?e.exploding.stage=n:e.exploding=void 0,e.dom.redraw())}function ro(e,n){function o(){Cn(e),n()}return{set(r){r.orientation&&r.orientation!==e.orientation&&o(),Ve(e,r),(r.fen?R:_)(t=>Ze(t,r),e)},state:e,getFen:()=>Rn(e.pieces),toggleOrientation:o,setPieces(r){R(t=>Mn(t,r),e)},selectSquare(r,t){r?R(i=>ie(i,r,t),e):e.selected&&(M(e),e.dom.redraw())},move(r,t){R(i=>Re(i,r,t),e)},newPiece(r,t){R(i=>fe(i,r,t),e)},playPremove(){if(e.premovable.current){if(R(Nn,e))return!0;e.dom.redraw()}return!1},playPredrop(r){if(e.predroppable.current){const t=Tn(e,r);return e.dom.redraw(),t}return!1},cancelPremove(){_(N,e)},cancelPredrop(){_(T,e)},cancelMove(){_(r=>{he(r),Q(r)},e)},stop(){_(r=>{ye(r),Q(r)},e)},explode(r){oo(e,r)},setAutoShapes(r){_(t=>t.drawable.autoShapes=r,e)},setShapes(r){_(t=>t.drawable.shapes=r,e)},getKeyAtDomPos(r){return z(r,w(e),e.dom.bounds())},redrawAll:n,dragNewPiece(r,t,i){Jn(e,r,t,i)},destroy(){ye(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function to(){return{pieces:je(me),orientation:"white",turnColor:"white",coordinates:!0,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},prevSvgHash:""},hold:yn()}}function ce(e,n,o){const r=new Map,t=[];for(const c of e)r.set(c.hash,!1);let i=n.firstChild,l;for(;i;)l=i.getAttribute("cgHash"),r.has(l)?r.set(l,!0):t.push(i),i=i.nextSibling;for(const c of t)n.removeChild(c);for(const c of e)r.get(c.hash)||n.appendChild(o(c))}function x(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function io(e,n,o){const r=e.drawable,t=r.current,i=t&&t.mouseSq?t:void 0,l=new Map,c=e.dom.bounds(),a=r.autoShapes.filter(u=>!u.piece);for(const u of r.shapes.concat(a).concat(i?[i]:[]))u.dest&&l.set(u.dest,(l.get(u.dest)||0)+1);const s=r.shapes.concat(a).map(u=>({shape:u,current:!1,hash:Se(u,l,!1,c)}));i&&s.push({shape:i,current:!0,hash:Se(i,l,!0,c)});const g=s.map(u=>u.hash).join(";");if(g===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=g;const d=n.querySelector("defs"),v=n.querySelector("g"),$=o.querySelector("g");co(r,s,d),ce(s.filter(u=>!u.shape.customSvg),v,u=>Ce(e,u,r.brushes,l,c)),ce(s.filter(u=>u.shape.customSvg),$,u=>Ce(e,u,r.brushes,l,c))}function co(e,n,o){const r=new Map;let t;for(const c of n)c.shape.dest&&(t=e.brushes[c.shape.brush],c.shape.modifiers&&(t=en(t,c.shape.modifiers)),r.set(t.key,t));const i=new Set;let l=o.firstChild;for(;l;)i.add(l.getAttribute("cgKey")),l=l.nextSibling;for(const[c,a]of r.entries())i.has(c)||o.appendChild(go(a))}function Se({orig:e,dest:n,brush:o,piece:r,modifiers:t,customSvg:i},l,c,a){return[a.width,a.height,c,e,n,o,n&&(l.get(n)||0)>1,r&&lo(r),t&&so(t),i&&ao(i)].filter(s=>s).join(",")}function lo(e){return[e.color,e.role,e.scale].filter(n=>n).join(",")}function so(e){return""+(e.lineWidth||"")}function ao(e){let n=0;for(let o=0;o<e.length;o++)n=(n<<5)-n+e.charCodeAt(o)>>>0;return"custom-"+n.toString()}function Ce(e,{shape:n,current:o,hash:r},t,i,l){let c;const a=Me(m(n.orig),e.orientation);if(n.customSvg)c=uo(n.customSvg,a,l);else if(n.dest){let s=t[n.brush];n.modifiers&&(s=en(s,n.modifiers)),c=po(s,a,Me(m(n.dest),e.orientation),o,(i.get(n.dest)||0)>1,l)}else c=fo(t[n.brush],a,o,l);return c.setAttribute("cgHash",r),c}function uo(e,n,o){const[r,t]=J(n,o),i=K(x("g"),{transform:`translate(${r},${t})`}),l=K(x("svg"),{width:1,height:1,viewBox:"0 0 100 100"});return i.appendChild(l),l.innerHTML=e,i}function fo(e,n,o,r){const t=J(n,r),i=ho(),l=(r.width+r.height)/(4*Math.max(r.width,r.height));return K(x("circle"),{stroke:e.color,"stroke-width":i[o?0:1],fill:"none",opacity:nn(e,o),cx:t[0],cy:t[1],r:l-i[1]/2})}function po(e,n,o,r,t,i){const l=vo(t&&!r),c=J(n,i),a=J(o,i),s=a[0]-c[0],g=a[1]-c[1],d=Math.atan2(g,s),v=Math.cos(d)*l,$=Math.sin(d)*l;return K(x("line"),{stroke:e.color,"stroke-width":mo(e,r),"stroke-linecap":"round","marker-end":"url(#arrowhead-"+e.key+")",opacity:nn(e,r),x1:c[0],y1:c[1],x2:a[0]-v,y2:a[1]-$})}function go(e){const n=K(x("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return n.appendChild(K(x("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),n.setAttribute("cgKey",e.key),n}function K(e,n){for(const o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.setAttribute(o,n[o]);return e}function Me(e,n){return n==="white"?e:[7-e[0],7-e[1]]}function en(e,n){return{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(n.lineWidth||e.lineWidth),key:[e.key,n.lineWidth].filter(o=>o).join("")}}function ho(){return[3/64,4/64]}function mo(e,n){return(e.lineWidth||10)*(n?.85:1)/64}function nn(e,n){return(e.opacity||1)*(n?.9:1)}function vo(e){return(e?20:10)/64}function J(e,n){const o=Math.min(1,n.width/n.height),r=Math.min(1,n.height/n.width);return[(e[0]-3.5)*o,(3.5-e[1])*r]}function bo(e,n){e.innerHTML="",e.classList.add("cg-wrap");for(const a of vn)e.classList.toggle("orientation-"+a,n.orientation===a);e.classList.toggle("manipulable",!n.viewOnly);const o=D("cg-container");e.appendChild(o);const r=D("cg-board");o.appendChild(r);let t,i,l;if(n.drawable.visible&&(t=K(x("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),t.appendChild(x("defs")),t.appendChild(x("g")),i=K(x("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),i.appendChild(x("g")),l=D("cg-auto-pieces"),o.appendChild(t),o.appendChild(i),o.appendChild(l)),n.coordinates){const a=n.orientation==="black"?" black":"",s=n.ranksPosition==="left"?" left":"";o.appendChild(xe(se,"ranks"+a+s)),o.appendChild(xe(le,"files"+a))}let c;return n.draggable.enabled&&n.draggable.showGhost&&(c=D("piece","ghost"),ue(c,!1),o.appendChild(c)),{board:r,container:o,wrap:e,ghost:c,svg:t,customSvg:i,autoPieces:l}}function xe(e,n){const o=D("coords",n);let r;for(const t of e)r=D("coord"),r.textContent=t,o.appendChild(r);return o}function wo(e,n){if(!e.dropmode.active)return;N(e),T(e);const o=e.dropmode.piece;if(o){e.pieces.set("a0",o);const r=B(n),t=r&&z(r,w(e),e.dom.bounds());t&&ze(e,"a0",t)}e.dom.redraw()}function yo(e,n){const o=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(n).observe(e.dom.elements.wrap),(e.disableContextMenu||e.drawable.enabled)&&o.addEventListener("contextmenu",t=>t.preventDefault()),e.viewOnly)return;const r=ko(e);o.addEventListener("touchstart",r,{passive:!1}),o.addEventListener("mousedown",r,{passive:!1})}function Po(e,n){const o=[];if("ResizeObserver"in window||o.push(G(document.body,"chessground.resize",n)),!e.viewOnly){const r=Ae(e,eo,Vn),t=Ae(e,no,Zn);for(const l of["touchmove","mousemove"])o.push(G(document,l,r));for(const l of["touchend","mouseup"])o.push(G(document,l,t));const i=()=>e.dom.bounds.clear();o.push(G(document,"scroll",i,{capture:!0,passive:!0})),o.push(G(window,"resize",i,{passive:!0}))}return()=>o.forEach(r=>r())}function G(e,n,o,r){return e.addEventListener(n,o,r),()=>e.removeEventListener(n,o,r)}const ko=e=>n=>{e.draggable.current?Q(e):e.drawable.current?Xe(e):n.shiftKey||_e(n)?e.drawable.enabled&&jn(e,n):e.viewOnly||(e.dropmode.active?wo(e,n):Yn(e,n))},Ae=(e,n,o)=>r=>{e.drawable.current?e.drawable.enabled&&o(e,r):e.viewOnly||n(e,r)};function So(e){const n=w(e),o=Y(e.dom.bounds()),r=e.dom.elements.board,t=e.pieces,i=e.animation.current,l=i?i.plan.anims:new Map,c=i?i.plan.fadings:new Map,a=e.draggable.current,s=Mo(e),g=new Set,d=new Set,v=new Map,$=new Map;let u,f,F,q,y,E,V,P,Z,I;for(f=r.firstChild;f;){if(u=f.cgKey,on(f))if(F=t.get(u),y=l.get(u),E=c.get(u),q=f.cgPiece,f.cgDragging&&(!a||a.orig!==u)&&(f.classList.remove("dragging"),A(f,o(m(u),n)),f.cgDragging=!1),!E&&f.cgFading&&(f.cgFading=!1,f.classList.remove("fading")),F){if(y&&f.cgAnimating&&q===U(F)){const h=m(u);h[0]+=y[2],h[1]+=y[3],f.classList.add("anim"),A(f,o(h,n))}else f.cgAnimating&&(f.cgAnimating=!1,f.classList.remove("anim"),A(f,o(m(u),n)),e.addPieceZIndex&&(f.style.zIndex=oe(m(u),n)));q===U(F)&&(!E||!f.cgFading)?g.add(u):E&&q===U(E)?(f.classList.add("fading"),f.cgFading=!0):re(v,q,f)}else re(v,q,f);else if(rn(f)){const h=f.className;s.get(u)===h?d.add(u):re($,h,f)}f=f.nextSibling}for(const[h,H]of s)if(!d.has(h)){Z=$.get(H),I=Z&&Z.pop();const k=o(m(h),n);if(I)I.cgKey=h,A(I,k);else{const S=D("square",H);S.cgKey=h,A(S,k),r.insertBefore(S,r.firstChild)}}for(const[h,H]of t)if(y=l.get(h),!g.has(h))if(V=v.get(U(H)),P=V&&V.pop(),P){P.cgKey=h,P.cgFading&&(P.classList.remove("fading"),P.cgFading=!1);const k=m(h);e.addPieceZIndex&&(P.style.zIndex=oe(k,n)),y&&(P.cgAnimating=!0,P.classList.add("anim"),k[0]+=y[2],k[1]+=y[3]),A(P,o(k,n))}else{const k=U(H),S=D("piece",k),j=m(h);S.cgPiece=k,S.cgKey=h,y&&(S.cgAnimating=!0,j[0]+=y[2],j[1]+=y[3]),A(S,o(j,n)),e.addPieceZIndex&&(S.style.zIndex=oe(j,n)),r.appendChild(S)}for(const h of v.values())De(e,h);for(const h of $.values())De(e,h)}function Co(e){const n=w(e),o=Y(e.dom.bounds());let r=e.dom.elements.board.firstChild;for(;r;)(on(r)&&!r.cgAnimating||rn(r))&&A(r,o(m(r.cgKey),n)),r=r.nextSibling}function $e(e){var n,o;const r=e.dom.elements.wrap.getBoundingClientRect(),t=e.dom.elements.container,i=r.height/r.width,l=Math.floor(r.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,c=l*i;t.style.width=l+"px",t.style.height=c+"px",e.dom.bounds.clear(),(n=e.addDimensionsCssVarsTo)===null||n===void 0||n.style.setProperty("--cg-width",l+"px"),(o=e.addDimensionsCssVarsTo)===null||o===void 0||o.style.setProperty("--cg-height",c+"px")}const on=e=>e.tagName==="PIECE",rn=e=>e.tagName==="SQUARE";function De(e,n){for(const o of n)e.dom.elements.board.removeChild(o)}function oe(e,n){const r=e[1];return`${n?3+7-r:3+r}`}const U=e=>`${e.color} ${e.role}`;function Mo(e){var n;const o=new Map;if(e.lastMove&&e.highlight.lastMove)for(const i of e.lastMove)O(o,i,"last-move");if(e.check&&e.highlight.check&&O(o,e.check,"check"),e.selected&&(O(o,e.selected,"selected"),e.movable.showDests)){const i=(n=e.movable.dests)===null||n===void 0?void 0:n.get(e.selected);if(i)for(const c of i)O(o,c,"move-dest"+(e.pieces.has(c)?" oc":""));const l=e.premovable.dests;if(l)for(const c of l)O(o,c,"premove-dest"+(e.pieces.has(c)?" oc":""))}const r=e.premovable.current;if(r)for(const i of r)O(o,i,"current-premove");else e.predroppable.current&&O(o,e.predroppable.current.key,"current-premove");const t=e.exploding;if(t)for(const i of t.keys)O(o,i,"exploding"+t.stage);return o}function O(e,n,o){const r=e.get(n);r?e.set(n,`${r} ${o}`):e.set(n,o)}function re(e,n,o){const r=e.get(n);r?r.push(o):e.set(n,[o])}function xo(e,n){const r=e.drawable.autoShapes.filter(t=>t.piece).map(t=>({shape:t,hash:Do(t),current:!1}));ce(r,n,t=>$o(e,t,e.dom.bounds()))}function Ao(e){var n;const o=w(e),r=Y(e.dom.bounds());let t=(n=e.dom.elements.autoPieces)===null||n===void 0?void 0:n.firstChild;for(;t;)Oe(t,r(m(t.cgKey),o),t.cgScale),t=t.nextSibling}function $o(e,{shape:n,hash:o},r){var t,i,l;const c=n.orig,a=(t=n.piece)===null||t===void 0?void 0:t.role,s=(i=n.piece)===null||i===void 0?void 0:i.color,g=(l=n.piece)===null||l===void 0?void 0:l.scale,d=D("piece",`${a} ${s}`);return d.setAttribute("cgHash",o),d.cgKey=c,d.cgScale=g,Oe(d,Y(r)(m(c),w(e)),g),d}const Do=e=>{var n,o,r;return[e.orig,(n=e.piece)===null||n===void 0?void 0:n.role,(o=e.piece)===null||o===void 0?void 0:o.color,(r=e.piece)===null||r===void 0?void 0:r.scale].join(",")};function qo(e,n){const o=to();Ze(o,n||{});function r(){const t="dom"in o?o.dom.unbind:void 0,i=bo(e,o),l=wn(()=>i.board.getBoundingClientRect()),c=g=>{So(s),i.autoPieces&&xo(s,i.autoPieces),!g&&i.svg&&io(s,i.svg,i.customSvg)},a=()=>{$e(s),Co(s),i.autoPieces&&Ao(s)},s=o;return s.dom={elements:i,bounds:l,redraw:Oo(c),redrawNow:c,unbind:t},s.drawable.prevSvgHash="",$e(s),c(!1),yo(s,a),t||(s.dom.unbind=Po(s,a)),s.events.insert&&s.events.insert(i),s}return ro(r(),r)}function Oo(e){let n=!1;return()=>{n||(n=!0,requestAnimationFrame(()=>{e(),n=!1}))}}function _o(e){let n;return{c(){n=dn("div"),this.h()},l(o){n=un(o,"DIV",{class:!0}),fn(n).forEach(we),this.h()},h(){pn(n,"class","scg_container svelte-15so71n")},m(o,r){gn(o,n,r),e[24](n)},p:ee,i:ee,o:ee,d(o){o&&we(n),e[24](null)}}}function Ko(e,n,o){let{fen:r=me}=n,{orientation:t="white"}=n,{config:i={}}=n,l,c;hn(async()=>{o(1,i.orientation??(i.orientation=t),i),o(1,i.fen??(i.fen=r),i),c=qo(l,i)});function a(p){c&&c.set(p)}function s(p){c.set(p)}function g(){return c.state}function d(){return c.getFen()}function v(){return c.toggleOrientation()}function $(p,L){return c.move(p,L)}function u(p){return c.setPieces(p)}function f(p,L){return c.selectSquare(p,L)}function F(p,L){return c.newPiece(p,L)}function q(){return c.playPremove()}function y(){c.cancelPremove()}function E(p){return c.playPredrop(p)}function V(){c.cancelPredrop()}function P(){c.cancelMove()}function Z(){c.stop()}function I(p){c.explode(p)}function h(p){c.setShapes(p)}function H(p){c.setAutoShapes(p)}function k(){return c.redrawAll()}function S(p,L,cn){c.dragNewPiece(p,L,cn)}function j(){return c.destroy()}function tn(p){mn[p?"unshift":"push"](()=>{l=p,o(0,l)})}return e.$$set=p=>{"fen"in p&&o(2,r=p.fen),"orientation"in p&&o(3,t=p.orientation),"config"in p&&o(1,i=p.config)},e.$$.update=()=>{e.$$.dirty&4&&a({fen:r}),e.$$.dirty&8&&a({orientation:t})},[l,i,r,t,s,g,d,v,$,u,f,F,q,y,E,V,P,Z,I,h,H,k,S,j,tn]}class To extends ln{constructor(n){super(),sn(this,n,Ko,_o,an,{fen:2,orientation:3,config:1,set:4,getState:5,getFen:6,toggleOrientation:7,move:8,setPieces:9,selectSquare:10,newPiece:11,playPremove:12,cancelPremove:13,playPredrop:14,cancelPredrop:15,cancelMove:16,stop:17,explode:18,setShapes:19,setAutoShapes:20,redrawAll:21,dragNewPiece:22,destroy:23})}get set(){return this.$$.ctx[4]}get getState(){return this.$$.ctx[5]}get getFen(){return this.$$.ctx[6]}get toggleOrientation(){return this.$$.ctx[7]}get move(){return this.$$.ctx[8]}get setPieces(){return this.$$.ctx[9]}get selectSquare(){return this.$$.ctx[10]}get newPiece(){return this.$$.ctx[11]}get playPremove(){return this.$$.ctx[12]}get cancelPremove(){return this.$$.ctx[13]}get playPredrop(){return this.$$.ctx[14]}get cancelPredrop(){return this.$$.ctx[15]}get cancelMove(){return this.$$.ctx[16]}get stop(){return this.$$.ctx[17]}get explode(){return this.$$.ctx[18]}get setShapes(){return this.$$.ctx[19]}get setAutoShapes(){return this.$$.ctx[20]}get redrawAll(){return this.$$.ctx[21]}get dragNewPiece(){return this.$$.ctx[22]}get destroy(){return this.$$.ctx[23]}}export{To as C};
